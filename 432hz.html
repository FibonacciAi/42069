setupControls() {
                // Get DOM elements
                this.elements = {
                    freq1Display: document.getElementById('freq1Display'),
                    freq2Display: document.getElementById('freq2Display'),
                    freq1Slider: document.getElementById('frequency1Slider'),
                    freq2Slider: document.getElementById('frequency2Slider'),
                    freq1Input: document.getElementById('frequency1Input'),
                    freq2Input: document.getElementById('frequency2Input'),
                    play1Btn: document.getElementById('play1Btn'),
                    play2Btn: document.getElementById('play2Btn'),
                    volume1Slider: document.getElementById('volume1Slider'),
                    volume2Slider: document.getElementById('volume2Slider'),
                    waveform1Select: document.getElementById('waveform1Select'),
                    waveform2Select: document.getElementById('waveform2Select'),
                    geometrySelect: document.getElementById('geometrySelect'),
                    syncBtn: document.getElementById('syncBtn'),
                    ratioDisplay: document.getElementById('ratioDisplay'),
                    relationshipInfo: document.getElementById('relationshipInfo'),
                    syncStatus: document.getElementById('syncStatus')
                };
            }

            setupEventListeners() {
                // Frequency Control Listeners
                this.elements.freq1Slider.addEventListener('input', (e) => {
                    this.updateFrequency(1, parseFloat(e.target.value));
                });

                this.elements.freq2Slider.addEventListener('input', (e) => {
                    this.updateFrequency(2, parseFloat(e.target.value));
                });

                // Play/Stop Buttons
                this.elements.play1Btn.addEventListener('click', () => this.toggleTone(1));
                this.elements.play2Btn.addEventListener('click', () => this.toggleTone(2));

                // Volume Controls
                this.elements.volume1Slider.addEventListener('input', (e) => {
                    this.state.volume1 = parseFloat(e.target.value);
                    if (this.state.isPlaying1) {
                        this.gainNode1.gain.setValueAtTime(this.state.volume1, this.audioCtx.currentTime);
                    }
                });

                this.elements.volume2Slider.addEventListener('input', (e) => {
                    this.state.volume2 = parseFloat(e.target.value);
                    if (this.state.isPlaying2) {
                        this.gainNode2.gain.setValueAtTime(this.state.volume2, this.audioCtx.currentTime);
                    }
                });

                // Waveform Selection
                this.elements.waveform1Select.addEventListener('change', (e) => {
                    this.oscillator1.type = e.target.value;
                });

                this.elements.waveform2Select.addEventListener('change', (e) => {
                    this.oscillator2.type = e.target.value;
                });

                // Geometry Selection
                this.elements.geometrySelect.addEventListener('change', (e) => {
                    this.state.currentGeometry = e.target.value;
                    this.createGeometry();
                });

                // Sync Button
                this.elements.syncBtn.addEventListener('click', () => {
                    this.state.syncVisualization = !this.state.syncVisualization;
                    this.elements.syncStatus.textContent = this.state.syncVisualization ? 
                        'Synchronized Visualization' : 'Independent Visualization';
                });

                // Fine Tuning Buttons
                document.getElementById('fineTuneDown1Btn').addEventListener('click', () => {
                    this.updateFrequency(1, this.state.freq1 - 1);
                });

                document.getElementById('fineTuneUp1Btn').addEventListener('click', () => {
                    this.updateFrequency(1, this.state.freq1 + 1);
                });

                document.getElementById('fineTuneDown2Btn').addEventListener('click', () => {
                    this.updateFrequency(2, this.state.freq2 - 1);
                });

                document.getElementById('fineTuneUp2Btn').addEventListener('click', () => {
                    this.updateFrequency(2, this.state.freq2 + 1);
                });

                // Octave Buttons
                document.getElementById('octaveDown1Btn').addEventListener('click', () => {
                    this.updateFrequency(1, this.state.freq1 / 2);
                });

                document.getElementById('octaveUp1Btn').addEventListener('click', () => {
                    this.updateFrequency(1, this.state.freq1 * 2);
                });

                document.getElementById('octaveDown2Btn').addEventListener('click', () => {
                    this.updateFrequency(2, this.state.freq2 / 2);
                });

                document.getElementById('octaveUp2Btn').addEventListener('click', () => {
                    this.updateFrequency(2, this.state.freq2 * 2);
                });
            }

            updateFrequency(oscillatorNumber, frequency) {
                // Clamp frequency between 20 and 20000 Hz
                frequency = Math.max(20, Math.min(20000, frequency));
                
                if (oscillatorNumber === 1) {
                    this.state.freq1 = frequency;
                    this.oscillator1.frequency.setValueAtTime(frequency, this.audioCtx.currentTime);
                    this.elements.freq1Display.textContent = `${frequency.toFixed(1)} Hz`;
                    this.elements.freq1Slider.value = frequency;
                    this.elements.freq1Input.value = frequency;
                } else {
                    this.state.freq2 = frequency;
                    this.oscillator2.frequency.setValueAtTime(frequency, this.audioCtx.currentTime);
                    this.elements.freq2Display.textContent = `${frequency.toFixed(1)} Hz`;
                    this.elements.freq2Slider.value = frequency;
                    this.elements.freq2Input.value = frequency;
                }

                this.updateHarmonicRelationship();
            }

            toggleTone(oscillatorNumber) {
                if (oscillatorNumber === 1) {
                    this.state.isPlaying1 = !this.state.isPlaying1;
                    this.gainNode1.gain.setValueAtTime(
                        this.state.isPlaying1 ? this.state.volume1 : 0, 
                        this.audioCtx.currentTime
                    );
                } else {
                    this.state.isPlaying2 = !this.state.isPlaying2;
                    this.gainNode2.gain.setValueAtTime(
                        this.state.isPlaying2 ? this.state.volume2 : 0, 
                        this.audioCtx.currentTime
                    );
                }
            }

            updateHarmonicRelationship() {
                const ratio = this.state.freq1 / this.state.freq2;
                const simplifiedRatio = this.simplifyRatio(ratio);
                this.elements.ratioDisplay.textContent = 
                    `${simplifiedRatio[0]}:${simplifiedRatio[1]}`;
                
                const relationship = this.getHarmonicRelationship(ratio);
                this.elements.relationshipInfo.textContent = relationship;
            }

            simplifyRatio(ratio) {
                const tolerance = 0.01;
                const maxDenominator = 16;
                let bestNum = 1;
                let bestDen = 1;
                let minError = Math.abs(ratio - 1);

                for (let den = 1; den <= maxDenominator; den++) {
                    const num = Math.round(ratio * den);
                    const error = Math.abs(ratio - num/den);
                    if (error < minError) {
                        minError = error;
                        bestNum = num;
                        bestDen = den;
                    }
                }

                return [bestNum, bestDen];
            }

            getHarmonicRelationship(ratio) {
                const relationships = {
                    1: "Perfect Unison",
                    1.5: "Perfect Fifth",
                    2: "Perfect Octave",
                    1.25: "Major Third",
                    1.3333: "Perfect Fourth",
                    1.6666: "Major Sixth",
                    1.875: "Major Seventh"
                };

                let closest = Object.entries(relationships).reduce((prev, curr) => {
                    return Math.abs(curr[0] - ratio) < Math.abs(prev[0] - ratio) ? curr : prev;
                });

                return closest[1];
            }

            animate() {
                requestAnimationFrame(() => this.animate());

                if (this.geometryGroup) {
                    if (this.state.syncVisualization) {
                        const rotationSpeed = 0.001;
                        this.geometryGroup.rotation.x += rotationSpeed;
                        this.geometryGroup.rotation.y += rotationSpeed;
                    } else {
                        this.state.phase1 += 0.01 * (this.state.isPlaying1 ? 1 : 0);
                        this.state.phase2 += 0.01 * (this.state.isPlaying2 ? 1 : 0);
                        
                        if (this.state.currentGeometry === 'lissajous') {
                            this.createLissajousGeometry();
                        }
                    }
                }

                this.controls.update();
                this.renderer.render(this.scene, this.camera);
            }
        }

        // Initialize the application
        const dualToneMatrix = new DualToneMatrix();
    </script>
</body>
</html>
